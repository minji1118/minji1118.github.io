<!DOCTYPE html>
<html>
<head>
    <title>책 리스트</title>
    <style>
        .book {
            border: 1px solid #ccc;
            display: inline-block;
            width: 180px;
            margin: 10px;
            padding: 5px;
            text-align: center;
        }
        .book img {
            width: 150px;
            height: 200px;
        }
    </style>
</head>
<body>
<h1>책 리스트</h1>

{% if session.get('user_id') %}
<p>로그인 완료! <a href="/logout">로그아웃</a></p>
{% else %}
<p><a href="/login_page">로그인</a> | <a href="/signup_page">회원가입</a></p>
{% endif %}

<div>
{% for book in books %}
    <div class="book">
        <img src="{{ url_for('static', filename='books/' + book.image_name) }}" alt="{{book.title}}">
        <h3>{{book.title}}</h3>
        <p>{{book.price}}원</p>
        {% if session.get('user_id') %}
        <button onclick="orderBook({{book.id}}, '{{book.file_name}}')">주문 & 보기</button>
        {% endif %}
    </div>
{% endfor %}
</div>

<h2>북뷰어</h2>
<iframe id="viewer" width="600" height="400"></iframe>

<script>
function orderBook(book_id, file_name){
    fetch("/order", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({book_id})
    })
    .then(res=>res.json())
    .then(data=>{
        alert(data.message);
        if(data.file_name){
            document.getElementById("viewer").src = "/view/"+data.file_name;
        }
    });
}
</script>
</body>
</html>
